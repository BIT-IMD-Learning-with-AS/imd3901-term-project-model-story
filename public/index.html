<!DOCTYPE html>
<html>
    <head>
        <title>Hello, Model&Story</title>
        <meta name="description" content="Hello, Model&Story!">
        <script src="js/aframe.min.js"></script>
        <script src="js/aframe-environment-component.min.js"></script>
        <script src = "js/time-effect.js"></script>
        <script src = "js/aframe-physics-system.js"></script> <!--Copy and pasted from the source Anthony gave us.-->
        <script src="https://mixedreality.mozilla.org/ammo.js/builds/ammo.wasm.js"></script>
        <script src="http://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>

        <!-- need a user gesture to allow sound on some browsers i.e. iOS -->
        <link rel="stylesheet" href="css/user-gesture.css">
        
        <script>
            AFRAME.registerComponent('start-experience', {
                init: function () {
                    //we can't play sound on some browsers until we have some user interaction
                    //this means we should only start playing ambient music after this button is clicked
                    console.log('scene loaded');
                    document.querySelector('#loading-animation').style.display = 'none';
                    document.querySelector('#user-gesture-button').style.display = 'block';
                }
            });

            //function called from user-gesture click
            const startExperience = function () {
                //hide user-gesture overlay
                document.querySelector('#user-gesture-overlay').style.display = 'none';

                //start all ambient music
                const ambientSounds = document.querySelectorAll('.ambient-music');
                ambientSounds.forEach(function (soundEntity) {
                    soundEntity.components.sound.playSound();
                });
            }
        </script>

    </head>


    <body>
        <!-- by having a 2D "user gesture" we can allow sounds to play and the like. We will make it an overlay so nothing can be clicked before the user gesture ... -->
        <!-- https://developers.google.com/web/updates/2017/09/autoplay-policy-changes (fun memes on webpage;) -->
        <div id="user-gesture-overlay">
            <div class="center">
                <button id="user-gesture-button" onclick="startExperience();">Enter Experience</button>
                <!-- loading gif from: https://www.behance.net/gallery/31234507/Open-source-Loading-GIF-Icons-Vol-1 -->
                <img id="loading-animation"
                    src="https://cdn.glitch.com/4d85200f-900f-4f4a-b950-82c4af80c1fb%2Floader.gif?v=1611262527887">
            </div>
        </div>

        <a-scene physics start-experience>

            <a-assets>
                <!--Starting to load in some SFX here-->
                <audio id="city_amb" src="assets/sound/citySounds.mp3" preload="auto" crossorigin="anonymous"></audio>
                <audio id = "good1_sfx" src = "assets/sound/goodSound_1.ogg" preload = "auto" crossorigin = "anonymous"></audio>
                <audio id="good2_sfx" src = "assets/sound/goodSound_2.ogg" preload = "auto" crossorigin = "anonymous"></audio>
                <audio id="light1_sfx" src = "assets/sound/lightSwitch_1.ogg" preload = "auto" crossorigin = "anonymous"></audio>
            </a-assets>

            <!--Sound coming from the windows test-->
            <a-entity class = "ambient-music" position="-4 2 -9" sound="src:#city_amb; autoplay:false"></a-entity>
            <a-entity class = "ambient-music" position="10 2 -9" sound="src:#city_amb; autoplay:false"></a-entity>

            <a-entity camera wasd-controls look-controls position = "0 13.5 0"> <!--spawning us high in an apartment-->
                <!--<a-entity light="type:spot; intensity:1.3; castShadow:true; shadowBias:-0.0005; angle:40; penumbra:0.3;" position = "0 1 0"></a-entity>-->
                <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive;"></a-entity>
            </a-entity>


            
            <a-entity id = "apartment" static-body>
                
                <a-entity id="floor" position="0 12.0 0"
                geometry="primitive: box; depth: 20.0; width:20.0; height:1.0;" material="color:rgb(200, 200, 200);"
                static-body></a-entity>
                <a-entity id="roof" position="0 16 0" rotation="-270 0 0" scale="20 20 20"
                geometry="primitive:plane; width:1.0; height:1.0;" material="color:rgb(200, 200, 200);"></a-entity>

                <a-entity id="wall" position="10 13 0" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:1.0; height:6.0; depth:20.0;" material="color:rgb(200, 200, 200);"></a-entity>
                <a-entity id="wall" position="-10 13 0" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:1.0; height:6.0; depth:20.0;" material="color:rgb(200, 200, 200);"></a-entity>
                <a-entity id="wall" position="0 13 10" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:20.0; height:6.0; depth:1.0;" material="color:rgb(200, 200, 200);"></a-entity>

                <a-entity id="wall" position="0 11 -10" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:20.0; height:4.0; depth:1.0;" material="color:rgb(200, 200, 200);"></a-entity>
                <a-entity id="wall" position="0 16 -10" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:20.0; height:3.0; depth:1.0;" material="color:rgb(200, 200, 200);"></a-entity>
                         
                <a-entity id="wall" position="3 13 -10" rotation="0 0 0" scaale="1 1 1"
                geometry="primitive: box; width:5.0; height:6.0; depth: 1;" material="color:rgb(200, 200, 200);"></a-entity>              
                <a-entity id="wall" position="3 13 7" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:0.4; height:6.0; depth:9.0;" material="color:rgb(200, 200, 200);"></a-entity>
                <a-entity id="wall" position="3 13 -7" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:0.4; height:6.0; depth:6.0;" material="color:rgb(200, 200, 200);"></a-entity>
                <a-entity id="wall" position="7 13 0" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:8.0; height:6.0; depth:0.4;" material="color:rgb(200, 200, 200);"></a-entity>
                <a-entity id="wall" position="7 13 0" rotation="0 0 0" scale="1 1 1"
                geometry="primitive: box; width:8.0; height:6.0; depth:0.4;" material="color:rgb(200, 200, 200);"></a-entity>


            </a-entity>

            <!-- Collision Testing and Physics Testing-->
            <a-box color = "#AA0000" position = "-3 14 -4"
            dynamic-body ></a-box>
            <a-box color = "#0000AA" position = "-3 16 -4.5"
            dynamic-body ></a-box>
            
            <!--Making a clock to toggle Day/Night-->
            <a-entity id="clock" class = "button interactive" position="3 14 5" geometry="primitive:cylinder; radius:0.8; height:0.5;" rotation ="0, 0, 90"
                material="color:white;"
                time-effect
                sound = "src:#light1_sfx; on:click;"
                animation__mouseenter="property:material.color; type:color; to:rgb(128, 128, 128); startEvents:mouseenter; dur:200;"
                animation__mouseleave="property:material.color; type:color; to:rgb(255, 255, 255); startEvents:mouseleave; dur:200;"
                animation__mouseclick="startEvents:click; dur:300;">
            </a-entity>
                
            <a-entity class = "back-environment" id = "bg" environment="preset:forest;"></a-entity>
        
        
        </a-scene>
    </body>
</html>